
ORDER TRACKING (TIMELINE) + TRACKING NUMBER (IMPLEMENTATION NOTES)
=================================================================

Goal
----
- Show a clear order tracking timeline:
	Pending → Processing → Shipped → Delivered
- Each step should show a date/time when it happened.
- Admin can update:
	- the shipping step (timeline status)
	- courier name
	- tracking number
- Users can see the timeline + tracking info on the Order page.


1) Data model changes (Backend)
------------------------------

File:
- Backend/models/order.model.js

We kept the existing `status` field for backward compatibility, but added a richer shipping timeline:

New fields:
- shippingStatus (Number)
	- 0 = Pending
	- 1 = Processing
	- 2 = Shipped
	- 3 = Delivered

- processingAt (Date)
- shippedAt (Date)
- deliveredAt (Date)

- trackingCarrier (String)
- trackingNumber (String)

Why we kept the old `status`:
- Existing code was using `status === 1` as “Completed/Delivered” and `status === 0` as “Pending”.
- Keeping it prevents breaking existing pages while we introduce the timeline.


2) Backend update logic (Admin-only)
-----------------------------------

File:
- Backend/controller/order.controller.js

Key behavior added to updateOrder:

A) Admin-only updates
- Updating an order (status/tracking) is now restricted to admin users.
- We check `req.user.role` and allow only roles like:
	admin / superadmin (also accepts super-admin).

B) Backward compatibility mapping
- If the old admin UI sends `status: 0/1`, we map it to the new shippingStatus:
	- status=0 → shippingStatus=0 (Pending)
	- status=1 → shippingStatus=3 (Delivered)

C) Keep legacy `status` in sync
- When shippingStatus changes:
	- if shippingStatus == 3 (Delivered) → status = 1
	- otherwise → status = 0

D) Automatic timeline dates
- When shippingStatus moves forward, the backend sets milestone timestamps:
	- shippingStatus >= 1 sets processingAt (if missing)
	- shippingStatus >= 2 sets shippedAt (if missing)
	- shippingStatus >= 3 sets deliveredAt (if missing)

Important:
- We load the existing order first and only set these dates if they are not already set.
- This prevents overwriting real historical timestamps when admin updates again.


3) Admin UI (Update status + tracking)
-------------------------------------

File:
- admin/src/pages/Orders.jsx

What was added:
- A 4-step shipping status dropdown per order:
	Pending / Processing / Shipped / Delivered

- Two new editable columns:
	- Courier (trackingCarrier)
	- Tracking # (trackingNumber)

- A “Save tracking” button per row that calls:
	PUT /api/V1/orders/:id
	with { trackingCarrier, trackingNumber }

Status display:
- Admin table now uses shippingStatus if it exists.
- If shippingStatus is missing (older orders), it falls back to legacy status:
	status=1 → Delivered (shippingStatus=3)
	otherwise → Pending (shippingStatus=0)


4) User UI (Timeline on Order page)
----------------------------------

File:
- frontend/src/pages/Order.jsx

What was added:
- A timeline component section that renders 4 steps with:
	- label (Pending/Processing/Shipped/Delivered)
	- date/time (if completed)

Which dates are shown:
- Pending uses order.createdAt
- Processing uses order.processingAt
- Shipped uses order.shippedAt
- Delivered uses order.deliveredAt (or order.updatedAt as a fallback if delivered)

Tracking details:
- If trackingCarrier or trackingNumber exists, we show them under the timeline.

Backward compatibility:
- If shippingStatus doesn’t exist on an order, we fall back to:
	status=1 → shippingStatus=3
	otherwise → shippingStatus=0


5) User Account “Order History” status badge
--------------------------------------------

File:
- frontend/src/pages/MyAccount.jsx

Change:
- The status badge now displays the shipping step:
	Pending / Processing / Shipped / Delivered
- Same fallback behavior for older orders (status → shippingStatus mapping).


6) How to test
--------------

1) Place an order (it will start as Pending).
2) In Admin → Orders:
	 - Change shipping status to Processing, then Shipped, then Delivered.
	 - Fill Courier + Tracking # and click Save tracking.
3) On the user side:
	 - Open the Order page and confirm:
		 - timeline updates correctly
		 - dates appear when steps are completed
		 - courier + tracking number appear

